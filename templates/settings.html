<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../static/index.css">
    <title>Document</title>
</head>
<body class="app">
    <div class="nav">
        <div class="nav-items">
            <div class="nav-header">
                <h3>Algo</h3>
                <button id="navToggle" class="nav-toggle">â˜°</button>
            </div>
            <div class="nav-links">
                <a href="{{url_for('dashboard')}}" class="nav-link {% if request.endpoint == 'dashboard' %}active{% endif %}">Dashboard</a>
                <a href="{{url_for('settings')}}" class="nav-link {% if request.endpoint == 'settings' %}active{% endif %}">Settings</a>
            </div>
            <div class="nav-footer">
                <a href="{{url_for('logout')}}" class="nav-link danger">Logout</a>
            </div>

        </div>
    </div>
    <div class="settings-main">
        <div class="settings-container">
            <div class="settings-title">
                <h1>Settings</h1>
            </div>
            <hr>
            <div class="auth-message">
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="alert {{category}}">
                                <p>{{ message }}</p>
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}
            </div>
                <form method="POST" class="change-username-form">
                    {{ username_form.hidden_tag() }}
        
                        <div class="input-container-settings">
                            <p>Username</p>
                            <div class="settings-change-name username-change">

                                {{ username_form.username (class="input-field settings") }}
                                {{ username_form.submit (class="button settings-username")}}

                            </div>
                    
                        </div>
                </form>
            <div class="account-names">
                <form method="POST" class="change-name-form">
                    {{ name_form.hidden_tag() }}
                    <div class="settings-change-name">
        
                        <div class="input-container-settings">
                            <p>First Name</p>
                            {{ name_form.first_name (class="input-field settings") }}
                        </div>
                        
                        <div class="input-container-settings">
                            <p>Last Name</p>
                            {{ name_form.last_name (class="input-field settings") }}
                        </div>
                    </div>
                    {{ name_form.submit (class="button settings")}}
                </form>
            </div>
            <div class="account-security">
                <h4>Account Security</h4>
                <hr>
                <div class="change-username-form">
                    <div class="input-container-settings">
                        <p>Email</p>
                        <div class="settings-change-name username-change">
                            <input disabled class="input-field settings" value="{{ current_user.email }}">
                                <a id="change-email" href="{{ url_for('settings') }}#email-change-card" class="button settings-username">Change Email</a>     
                        </div>
                    </div>

                </div>
                <div class="change-username-form">
                    <div class="input-container-settings">
                        <p>Password</p>
                        <div class="settings-change-name username-change">
                            <input type="password" disabled class="input-field settings" value="safnjasfgn ">
                                <a id="change-password" href="{{ url_for('settings') }}#password-change-card" class="button settings-username">Change password</a>     
                        </div>
                    </div>

                </div>

            </div>
             <div class="account-deletion">
                <h4>Account Deletion</h4>
                <hr>
                <div class="change-username-form">
                    <div class="input-container-settings">
                        <div class="settings-change-name username-change account-deletion">
                            <h5>Delete Account</h5>
                                <a id="delete-account" href="{{ url_for('settings') }}#delete-account" class="button settings-username account-deletion-button">Delete Account?</a>     
                        </div>
                    </div>

                </div>

            </div>
        </div>
        <div class="settings-container">
            <div class="logout">
                <div class="change-username-form">
                    <div class="input-container-settings">
                        <div class="settings-change-name username-change account-deletion">
                            <h5>Logout</h5>
                                <a href="{{ url_for('logout') }}" class="button settings-username account-deletion-button">Logout</a>     
                        </div>
                    </div>
    
                </div>
    
            </div>
        </div>
    </div>
    <div id="email-change-card" class="card-popup-wrapper">
        <div class="card popup">
            <h2>Change Email</h2>
            <p>Please enter your password to change your email.</p>
            
            {% if not is_validated %}
            <form method="POST" class="form-container">
                {{ password_validation_form.hidden_tag() }}
                <div class="input-container">
                    {{ password_validation_form.password(class="input-field") }}
                </div>
                {{ password_validation_form.submit(class="button") }}
            </form>
            {% endif %}

            {% if is_validated %}
                <form method="POST" class="form-container">
                    {{ email_form.hidden_tag() }}
                    <div class="input-container">
                        {{ email_form.email(class="input-field") }}
                    </div>
                    {{ email_form.submit(class="button") }}
                </form>
            {% endif %}
        </div>
    </div>
    <div id="password-change-card" class="card-popup-wrapper">
        <div class="card popup">
            <h2>Change Password</h2>
            <p>Please enter your password to change your password.</p>
            {% if not is_validated %}
            
            <form method="POST" class="form-container">
                {{ password_validation_form.hidden_tag() }}
                <div class="input-container">
                    {{ password_validation_form.password(class="input-field") }}
                </div>
                {{ password_validation_form.submit(class="button") }}
            </form>
            {% endif %}
            {% if is_validated %}
                <form method="POST" class="form-container">
                    {{ change_password_form.hidden_tag() }}
                    <div class="input-container">
                        {{ change_password_form.password(class="input-field") }}
                    </div>
                    <div class="input-container">
                        {{ change_password_form.confirm_password(class="input-field") }}
                    </div>
                    {{ change_password_form.submit(class="button") }}
                </form>
            {% endif %}
        </div>
    </div>
    <div id="account-deletion-card" class="card-popup-wrapper">
        <div class="card popup">
            <h2>Account Deletion</h2>
            {% if not is_validated %}
            <p>Please enter your password to delete your account.</p>
            
            <form method="POST" class="form-container">
                {{ password_validation_form.hidden_tag() }}
                <div class="input-container">
                    {{ password_validation_form.password(class="input-field") }}
                </div>
                {{ password_validation_form.submit(class="button") }}
            </form>
            {% endif %}
            {% if is_validated %}
            <p>Are you sure you want to delete your account. This is an irreversible action. You will lose progress and will have to create a new account to use the application again.</p>
                <form method="POST" class="form-container">
                    {{ account_deletion_form.hidden_tag() }}
                    {{ account_deletion_form.submit(class="button account-deletion-button") }}
                </form>
            {% endif %}
        </div>
    </div>
    
    <script src="../static/js/message-popup.js"></script>
    <script src="../static/js/card-popup.js"></script>
    <script src="../static/js/toggle-nav.js"></script>
</body>
</html>